---
navigation_title: AWS
description: Set up the EDOT Cloud Forwarder for AWS to bring your AWS logs to Elastic Observability.
applies_to:
  serverless:
    observability: preview
  product:
    edot_cf_aws: preview
products:
  - id: cloud-serverless
  - id: observability
  - id: edot-cf
---

# EDOT Cloud Forwarder for AWS

{{edot-cf}} for AWS provides the EDOT Collector as a Lambda function that collects and forwards logs to Elastic Observability on {{serverless-full}}. {{edot-cf}} for AWS supports the following log sources:

| Log source | Description |
| --- | --- |
| VPC Flow   | Logs generated by a Virtual Private Cloud (VPC)  |
| ELB Access | Logs generated by an Elastic Load Balancer (ELB) |
% | CloudWatch {applies_to}`product: planned` | Logs generated by AWS CloudWatch |

Read on to learn how to set up {{edot-cf}} for AWS.

::::{note}
We are working to support other popular log types and sources. Get in touch to let us know of any specific requirements that could influence our plans.
::::

## Prerequisites

::::{important}
{{edot-cf}} for AWS is not currently supported on {{ech}} or self-managed {{stack}}.
::::


To collect logs using {{edot-cf}} for AWS, you need:

::::{tab-set}

:::{tab-item} VPC Flow

To collect VPC Flow logs, you need:

- A Virtual Private Cloud (VPC)
- An S3 bucket for storing flow logs
- A flow log configured with the S3 bucket as the destination

:::

:::{tab-item} ELB Access

To collect Elastic Load Balancer (ELB) Access logs, you need:

- An ELB of any type (ALB, NLB, CLB)
- An S3 bucket to store the access logs
- Access logging enabled, with the bucket as the destination

:::

<!--
:::{tab-item} CloudWatch

To collect CloudWatch logs, you need:

- A CloudWatch Log Group where logs are stored

:::
-->
::::

In addition, you need to know the URL of the managed OTLP endpoint and the API key for authentication.

::::{dropdown} Steps to retrieve the OTLP endpoint and API key

:::{include} ../_snippets/serverless-endpoint-api.md
:::

In the CloudFormation templates, the OTLP endpoint is set as `OTLPEndpoint`, and the API key is set as `ElasticAPIKey`. 

:::{important}
Trim the API key from `Authorization=ApiKey MYKEYVALUE...` to just `MYKEYVALUE...` before using it as the argument to the `ElasticAPIKey` parameter.
:::
::::

## Deployment considerations

Before deploying {{edot-cf}} for AWS, keep these points in mind:

- Deploy a separate CloudFormation stack for each log type, for example VPC Flow Logs or ELB Logs. Each CloudFormation stack can only process one log source and format at a time.
- Logs stored in S3 must be placed in separate buckets. Each log type should reside in its own dedicated bucket.
- The CloudFormation stack deployment region must match the region of the S3 bucket.

## Download the template [download-templates]

Download the CloudFormation template to deploy the appropriate stack based on your log source:

| Log Source | CloudFormation template |
| --- | ------------------------------------------------ |
| S3 logs | `https://edot-cloud-forwarder.s3.amazonaws.com/v1/latest/cloudformation/s3_logs-cloudformation.yaml` |
% | CloudWatch logs | `https://edot-cloud-forwarder.s3.amazonaws.com/v0/latest/cloudformation/cloudwatch_logs-cloudformation.yaml` |

For specific versions, edit `latest` in the URL to the required version in the format `vX.Y.Z`.

## Configure the template

{{edot-cf}} for AWS uses a CloudFormation template to deploy the EDOT Collector as a Lambda function.

### Required settings

These are the required settings you need:

| Setting                                | Description |
| -------------------------------------- | ----------- |
| `region`                               | AWS region where the CloudFormation stack is to be deployed |
| `stack-name`                           | Name of the CloudFormation stack, for example, `vpc-edot-cf`<br>Do not use the same name for different sources. |
| `OTLPEndpoint`                         | The OTLP endpoint URL used for data ingestion |
| `ElasticApiKey`                        | API key for authentication with Elastic |

### Log source settings

Set the following settings based on the log source:

:::::{tab-set}

::::{tab-item} S3

For S3 logs, use the following settings:

| Setting            | Description |
| ------------------ | --- |
| `EdotCloudForwarderS3LogsType` | The encoding format for logs in the S3 bucket. Supported options:<br>- `vpcflow`: VPC Flow logs<br>- `elbaccess`: Elastic Load Balancer (ELB) Access logs|
| `SourceS3BucketARN` | Amazon Resource Name (ARN) of the S3 bucket where logs are stored. This bucket will trigger the `edot-cloud-forwarder` Lambda function automatically. |
% | `S3LogsJsonEncodingMode` | _(Required if `EdotCloudForwarderS3LogsType` is `json`)_<br>Defines how JSON logs are structured:<br>- `body` _(default)_: Stores logs in the request body<br>- `body_with_inline_attributes`: Logs include inline attributes |

::::

<!-- TODO: Enable when CloudWatch logs are supported
::::{tab-item} CloudWatch

For CloudWatch logs, use the following settings:

| Setting            | Description |
| ------------------- | --- |
| `SourceCloudWatchLogGroupARN` | Amazon Resource Name (ARN) of the CloudWatch Log Group where the subscription filter will be created. This Log Group serves as the primary storage location for logs. |

:::{note}
The log group must already exist in your AWS account and region. If the ARN points to a non-existent log group, stack deployment or updates might fail.
:::
::::

-->

:::::

### Optional settings

These are optional settings you can set in the CloudFormation template:

| Setting            | Description                                                                                                                                                                                                  |
| ------------------- |--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `EdotCloudForwarderTimeout` | Maximum execution time for the Lambda function, measured in seconds. Default value is `300` seconds. Minimum value is `1` second. Maximum value is `900` seconds.                                            |
| `EdotCloudForwarderVersion` | Version of the EDOT Cloud Forwarder. Expected format is semantic versioning, for example `1.0.0`. Defaults to the latest available patch version. Don't change this value unless advised by Elastic Support. |
| `EdotCloudForwarderMemorySize` | Set the allocated memory for the Lambda function, measured in megabytes. Default value is `512` MB. Minimum value is `128` MB. Maximum value is `10240` MB.                                                  | 
| `EdotCloudForwarderConcurrentExecutions` | Set the maximum number of reserved concurrent executions for the Lambda function. Default value is `5`. Make sure this value doesn't exceed your AWS account's concurrency limit.                            |
| `EdotCloudForwarderExporterMaxQueueSize` | Set the internal OTLP exporter queue size. Default is `50` MB. You may incease this based on the data volume.                                                                                                |

Default values of `EdotCloudForwarderMemorySize` and `EdotCloudForwarderConcurrentExecutions` should be sufficient for most use cases. 
However, depending on your data volumes (individual Signal size such as size of S3 object per VPC log entry), you may need to finetune them.
Key indications for the need of tuning these parameters are Lambda throttling and Lambda timeouts.
Along with these, you may also need to adjust `EdotCloudForwarderExporterMaxQueueSize` to export higher data volumes.

## Deployment examples

The following examples use the CloudFormation template files hosted in the [public S3 bucket](#download-templates).

- Use the `--template-url` flag to reference a template hosted on S3. 
- To always use the most recent stable templates, use the `latest` path. For example, `v1/latest`.  
- To pin a specific version, replace `latest` with the desired version tag. For example, `v1/v1.0.0`.  

Alternatively, if you have downloaded the template file, you can use the `--template-body file://<path>` option with a local template file.

:::::{tab-set}
::::{tab-item} VPC Flow logs

This example deploys a CloudFormation stack to collect VPC Flow logs stored in an S3 bucket.

```sh
aws cloudformation create-stack \
  --stack-name edot-cloud-forwarder-vpc \
  --template-url https://edot-cloud-forwarder.s3.amazonaws.com/v1/latest/cloudformation/s3_logs-cloudformation.yaml \
  --capabilities CAPABILITY_NAMED_IAM \
  --region eu-central-1 \
  --parameters \
    ParameterKey=SourceS3BucketARN,ParameterValue=your-s3-vpc-bucket-arn \
    ParameterKey=OTLPEndpoint,ParameterValue="<placeholder>" \
    ParameterKey=ElasticAPIKey,ParameterValue="<placeholder>" \
    ParameterKey=EdotCloudForwarderS3LogsType,ParameterValue="vpcflow"
```
::::

::::{tab-item} ELB Access logs

This example deploys a CloudFormation stack to collect ALB Access logs stored in an S3 bucket.

```sh
aws cloudformation create-stack \
  --stack-name edot-cloud-forwarder-alb \
  --template-url https://edot-cloud-forwarder.s3.amazonaws.com/v1/latest/cloudformation/s3_logs-cloudformation.yaml \
  --capabilities CAPABILITY_NAMED_IAM \
  --region eu-central-1 \
  --parameters \
    ParameterKey=SourceS3BucketARN,ParameterValue=your-s3-alb-bucket-arn \
    ParameterKey=OTLPEndpoint,ParameterValue="<placeholder>" \
    ParameterKey=ElasticAPIKey,ParameterValue="<placeholder>" \
    ParameterKey=EdotCloudForwarderS3LogsType,ParameterValue="elbaccess"
```
::::

<!-- To be added post GA

::::{tab-item} S3 Access logs

This example deploys a CloudFormation stack to collect S3 Access logs stored in an S3 bucket.

```sh
aws cloudformation create-stack \
  --stack-name edot-cloud-forwarder-s3-access \
  --template-url https://edot-cloud-forwarder.s3.amazonaws.com/v0/latest/cloudformation/s3_logs-cloudformation.yaml \
  --capabilities CAPABILITY_NAMED_IAM \
  --region eu-central-1 \
  --parameters \
    ParameterKey=SourceS3BucketARN,ParameterValue=your-s3-access-logs-bucket-arn \
    ParameterKey=OTLPEndpoint,ParameterValue="<placeholder>" \
    ParameterKey=ElasticAPIKey,ParameterValue="<placeholder>" \
    ParameterKey=EdotCloudForwarderS3LogsType,ParameterValue="s3_access_log"
```
::::

::::{tab-item} CloudTrail logs

This example deploys a CloudFormation stack to collect CloudTrail logs stored in an S3 bucket.

```sh
aws cloudformation create-stack \
  --stack-name edot-cloud-forwarder-cloudtrail \
  --template-url https://edot-cloud-forwarder.s3.amazonaws.com/v0/latest/cloudformation/s3_logs-cloudformation.yaml \
  --capabilities CAPABILITY_NAMED_IAM \
  --region eu-central-1 \
  --parameters \
    ParameterKey=SourceS3BucketARN,ParameterValue=your-cloudtrail-bucket-arn \
    ParameterKey=OTLPEndpoint,ParameterValue="<placeholder>" \
    ParameterKey=ElasticAPIKey,ParameterValue="<placeholder>" \
    ParameterKey=EdotCloudForwarderS3LogsType,ParameterValue="cloudtrail_log"
```
::::

::::{tab-item} WAF logs

This example deploys a CloudFormation stack to collect AWS WAF logs stored in an S3 bucket.

```sh
aws cloudformation create-stack \
  --stack-name edot-cloud-forwarder-waf \
  --template-url https://edot-cloud-forwarder.s3.amazonaws.com/v0/latest/cloudformation/s3_logs-cloudformation.yaml \
  --capabilities CAPABILITY_NAMED_IAM \
  --region eu-central-1 \
  --parameters \
    ParameterKey=SourceS3BucketARN,ParameterValue=arn:aws:s3:::aws-waf-logs-your-bucket-arn \
    ParameterKey=OTLPEndpoint,ParameterValue="<placeholder>" \
    ParameterKey=ElasticAPIKey,ParameterValue="<placeholder>" \
    ParameterKey=EdotCloudForwarderS3LogsType,ParameterValue="waf_log"
```

:::{note}
Replace `aws-waf-logs-your-bucket-name` with your actual WAF logging bucket ARN. Remember that the bucket name must start with `aws-waf-logs-` as required by AWS WAF.
:::
::::

::::{tab-item} JSON logs

This example deploys a CloudFormation stack to collect JSON-formatted logs stored in an S3 bucket.

```sh
aws cloudformation create-stack \
  --stack-name edot-cloud-forwarder-json \
  --template-url https://edot-cloud-forwarder.s3.amazonaws.com/v0/latest/cloudformation/s3_logs-cloudformation.yaml \
  --capabilities CAPABILITY_NAMED_IAM \
  --region eu-central-1 \
  --parameters \
    ParameterKey=SourceS3BucketARN,ParameterValue=your-json-logs-bucket-arn \
    ParameterKey=OTLPEndpoint,ParameterValue="<placeholder>" \
    ParameterKey=ElasticAPIKey,ParameterValue="<placeholder>" \
    ParameterKey=EdotCloudForwarderS3LogsType,ParameterValue="json" \
    ParameterKey=S3LogsJsonEncodingMode,ParameterValue="body"
```
::::

::::{tab-item} CloudWatch logs

This example deploys a CloudFormation stack to collect CloudWatch logs sent to a Log Group.

```sh
aws cloudformation create-stack \
  --stack-name edot-cloud-forwarder-cw \
  --template-url https://edot-cloud-forwarder.s3.amazonaws.com/v0/latest/cloudformation/cloudwatch_logs-cloudformation.yaml \
  --capabilities CAPABILITY_NAMED_IAM \
  --region eu-central-1 \
  --parameters \
    ParameterKey=OTLPEndpoint,ParameterValue="<placeholder>" \
    ParameterKey=ElasticAPIKey,ParameterValue="<placeholder>" \
    ParameterKey=SourceCloudWatchLogGroupARN,ParameterValue="<your-log-group-arn>"
```

-->

:::{note}
The `--capabilities CAPABILITY_NAMED_IAM` flag is required because this CloudFormation template creates AWS Identity and Access Management (IAM) resources. More specifically, it creates a named IAM role (`LambdaExecutionRole`) for the Lambda function. To acknowledge that AWS CloudFormation might create or modify IAM resources with custom names, you must specify the `CAPABILITY_NAMED_IAM` capability. 
:::

::::
:::::

To update an existing CloudFormation stack while preserving some parameter values, follow these steps:

::::::{stepper}

:::::{step} Identify the stack to update

Determine the name of the CloudFormation stack you want to modify.

:::::

:::::{step} Prepare the update command

Use the following structure for your update command:

- Include all required parameters.
- Use `UsePreviousValue=true` for parameters that should remain unchanged.
- Specify `ParameterValue=<new-value>` for parameters that need to be updated.

:::::

:::::{step} Run the `update-stack` command

Run the command with the following parameters:

```sh
aws cloudformation update-stack \
  --template-url https://edot-cloud-forwarder.s3.amazonaws.com/v1/latest/cloudformation/<template-file-name>.yaml \
  --stack-name <stack-name> \
  --capabilities CAPABILITY_NAMED_IAM \
  --region eu-central-1 \
  --parameters \
      ParameterKey=Param1,UsePreviousValue=true \
      ParameterKey=Param2,UsePreviousValue=true \
      ParameterKey=Param3,UsePreviousValue=true \
      ParameterKey=Param4,ParameterValue=<new-value>
```
::::{dropdown} Example using S3 logs template
For example, to modify the S3 bucket ARN for the `edot-cloud-forwarder-vpc` stack while keeping other parameter values unchanged:

```sh
aws cloudformation update-stack \
  --template-url https://edot-cloud-forwarder.s3.amazonaws.com/v1/latest/cloudformation/s3_logs-cloudformation.yaml \
  --stack-name edot-cloud-forwarder-vpc \
  --capabilities CAPABILITY_NAMED_IAM \
  --region eu-central-1 \
  --parameters \
      ParameterKey=OTLPEndpoint,UsePreviousValue=true \
      ParameterKey=ElasticAPIKey,UsePreviousValue=true \
      ParameterKey=EdotCloudForwarderS3LogsType,UsePreviousValue=true \
      ParameterKey=SourceS3BucketARN,ParameterValue=your-new-s3-vpc-bucket-arn
```
::::
:::::

:::::{step} Verify the update

After running the command, check the stack status in the AWS Management Console under **CloudFormation** → **Stacks**. Then, run this command to confirm the updated parameter values:

```sh
aws cloudformation describe-stacks --stack-name <stack-name>
```
:::::
::::::

## Manual deployment using the CloudFormation Console

You can deploy the stack manually using the AWS Management Console by following these steps:

1. Navigate to **CloudFormation** in the AWS Console.  
2. Select **Create Stack** and choose **With new resources (standard)** to start a fresh deployment.
3. Select one of the following options under **Specify template**:  
   - **Amazon S3 URL (Recommended)**: Use the pre-hosted CloudFormation template stored in the [public S3 bucket](#download-templates).  
   - **Upload a template file**: Download the template from the S3 bucket and upload it manually.
4. Select **Next** and configure all required parameters.  
5. Select **Next** again and check **Acknowledge IAM capabilities**. This is required because the template creates named IAM roles with permissions to access the required resources.  
6. Review your configuration and select **Submit** to deploy the stack.  
7. Monitor the progress until the stack reaches the `CREATE_COMPLETE` state. 

## Deployment using the AWS Serverless Application Repository

In addition to deploying via CloudFormation templates, you can deploy the EDOT Cloud Forwarder application directly from the AWS Serverless Application Repository (SAR).

:::{note}
The same [deployment considerations](#deployment-considerations) apply to SAR deployments, including the requirement to deploy separate serverless applications for each log type and ensure the deployment region matches your S3 bucket region.
:::

To deploy from SAR, follow these steps:

1. Navigate to **AWS Serverless Application Repository** in the AWS Management Console.
2. Search for `edot-cloud-forwarder-s3-logs` and select the application.
3. Select **Deploy**.
4. **Configure the application settings**: You will be prompted to fill in the same parameters described in the [Required settings](#required-settings), [Log source settings](#log-source-settings), and [Optional settings](#optional-settings) sections. Refer to those sections for details on each parameter.
5. **Acknowledge IAM role creation**: At the bottom of the page, check the box to acknowledge that the application will create custom IAM roles. This is required for the forwarder to access your S3 bucket and send data to Elastic Observability.
6. Select **Deploy**.

The deployment process will start, and a CloudFormation stack will be created with all the necessary resources. You can monitor the progress in the AWS CloudFormation console under **Stacks**.

## CloudFormation stack resources

The CloudFormation templates create a number of resources to process logs from a specific log source.

### Resources for S3 logs

This is a list of resources created by the stack when processing S3 logs.

| Resource name               | Type                             | Description |
|---------------------------|--------------------------------------|----------------|
| `CustomNotificationUpdater` | `AWS::CloudFormation::CustomResource` | Custom resource used to manage S3 event notifications dynamically. |
| `LambdaExecutionRole`       | `AWS::IAM::Role`                   | IAM role granting permissions needed for the Lambda function to interact with S3 and other AWS services. |
| `LambdaFunction`            | `AWS::Lambda::Function`            | Core Lambda function responsible for processing incoming logs from S3. This is a key resource in the stack. |
| `LambdaInvokeConfig`        | `AWS::Lambda::EventInvokeConfig`   | Configures error handling and invocation settings for the Lambda function. |
| `LambdaLogGroup`            | `AWS::Logs::LogGroup`               | CloudWatch log group storing logs for the main Lambda function. Useful for debugging and monitoring. |
| `LambdaPermissionS3Bucket`  | `AWS::Lambda::Permission`          | Grants permission for S3 to invoke the Lambda function when new logs arrive. |
| `LambdaS3TriggerPolicy`     | `AWS::IAM::Policy`                 | IAM policy allowing the Lambda function to process events triggered by S3. |
| `NotificationUpdaterLambda` | `AWS::Lambda::Function`            | Utility Lambda function handling S3 event notification updates dynamically. |
| `NotificationUpdaterLambdaLogGroup` | `AWS::Logs::LogGroup`         | CloudWatch log group storing logs for the `NotificationUpdaterLambda` function. |
| `S3FailureBucketARN`               | `AWS::S3::Bucket`                   | ARN of the bucket for storing failed invocations from the `edot-cloud-forwarder` Lambda function, preventing data loss, in the format `arn:aws:s3:::your-bucket-name`. If not defined, the template creates a dedicated failure bucket automatically. |

The main Lambda function, `LambdaFunction`, is the core component for processing S3 logs. S3 event notifications are handled dynamically using `CustomNotificationUpdater` and `NotificationUpdaterLambda`. 

CloudWatch logs ensure detailed monitoring of Lambda executions. IAM roles and permissions control access between S3 and Lambda functions, while `S3FailureBucketARN` prevents data loss by capturing unprocessed logs.


<!-- TODO: Enable when CloudWatch logs are supported

### Resources for CloudWatch Logs

This is a list of resources created by the stack when CloudWatch logs are the source.

| Resource name                  | Type                             | Description |
|------------------------------------|--------------------------------------|----------------|
| `CloudWatchLogSubscriptionFilter` | `AWS::Logs::SubscriptionFilter` | Defines a filter that forwards logs from a CloudWatch Log Group to the Lambda function. Critical for log processing. |
| `LambdaExecutionRole`              | `AWS::IAM::Role`                   | IAM role granting necessary permissions for the Lambda function to interact with CloudWatch Logs and other AWS services. |
| `LambdaFunction`                   | `AWS::Lambda::Function`            | Core Lambda function responsible for processing incoming logs from CloudWatch. This is a key resource in the stack. |
| `LambdaInvokeConfig`               | `AWS::Lambda::EventInvokeConfig`   | Configures event invocation settings, including error handling and retry behavior. |
| `LambdaLogGroup`                   | `AWS::Logs::LogGroup`               | CloudWatch log group that stores execution logs for the main Lambda function, aiding monitoring and debugging. |
| `LambdaPermissionCloudWatch`       | `AWS::Lambda::Permission`          | Grants permission for CloudWatch Logs to invoke the Lambda function, enabling real-time log streaming. |
| `S3FailureBucketARN`               | `AWS::S3::Bucket`                   | ARN of the bucket for storing failed log events to prevent data loss, in the format `arn:aws:s3:::your-bucket-name`. |

The CloudWatch Log Subscription Filter, `CloudWatchLogSubscriptionFilter`, ensures logs are correctly forwarded to the Lambda function. The Lambda function, `LambdaFunction`, serves as the core processing unit for CloudWatch logs. 

CloudWatch Log Groups help monitor execution performance and debug issues. IAM permissions (`LambdaExecutionRole`, `LambdaPermissionCloudWatch`) control interactions between CloudWatch and Lambda, while the failure bucket, `S3FailureBucketARN`, helps prevent data loss in case of processing errors.

-->
## Kibana integration setup

After {{edot-cf}} for AWS is successfully running and forwarding logs to Elastic Observability, you can install pre-built integrations in Kibana to visualize your data with out-of-the-box dashboards and visualizations.

### Install integrations

To set up data visualization for your AWS logs:

1. **Navigate to Kibana**: Log into your Elastic Cloud deployment and open Kibana.

2. **Access Integrations**: Go to **Management** → **Integrations** in the Kibana navigation menu.

3. **Search and install**: Search for the appropriate integration based on your log type and install it:

| **AWS Log Type** | **Integration Name** | **Description** |
|------------------|---------------------|-----------------|
| ELB Access Logs | **AWS ELB OpenTelemetry Assets** | Dashboards and visualizations for Elastic Load Balancer logs |
| VPC Flow Logs | **AWS VPC Flow Logs OpenTelemetry Assets** | Dashboards and visualizations for VPC flow log data |

4. **Access dashboards**: Once installed, navigate to **Dashboard** to view the pre-built dashboards for your AWS log data.

### Benefits

This allows you to immediately start analyzing your AWS infrastructure without building dashboards from scratch.

## Error handling and retrying

{{edot-cf}} store Lambda invocation events related to retryable errors at the S3 bucket specified by `S3FailureBucketARN` parameter.
Retryable errors here include, 
 - Network errors when attempting to forward to OTLPEndpoint
 - Invalid or expired ElasticApiKey
 - Lambda triggered by events that mismatch EdotCloudForwarderS3LogsType selection 

These errors can be replayed manually to back-fill any gaps in your data.

### Replay failed events

To replay errors simply invoke the Lambda with manual trigger type `replayFailedEvents`,

```sh
aws lambda invoke \
  --function-name <LAMBDA_NAME> \
  --payload '{ "replayFailedEvents": {"replayFailedEvents":{"dryrun":false,"removeOnSuccess":true}}}' \
  --cli-binary-format raw-in-base64-out /dev/null
```
Replace `<LAMBDA_NAME>` with the name from your deployment.

Table below explains supported configuration options,

| Option          | Description                                                                                                                                   | Default |
|-----------------|-----------------------------------------------------------------------------------------------------------------------------------------------|---------|
| dryrun          | Run the command without processing actual backup events. Useful to understand details about replaying error files from Lambda CloudWatch logs | false   |
| removeOnSuccess | Configure whether to remove error event from S3 error destination, if processing is successful                                                | true    |

When successful, you should see `"StatusCode": 200` as an output. You may check CloudWatch logs (resource `LambdaLogGroup`) for detailed logs.

:::{note}
With AWS CLI, you can use `--timeout` option to increase currently configured Lambda timeout for custom invocations.
However, if a timeout occur, you will need to run the custom event multiple times to fully process all error events from the bucket.
:::

## **Delete a CloudFormation stack**

If you no longer need a deployed stack and want to clean up all associated resources, you can delete it using the following command:

```sh
aws cloudformation delete-stack \
  --stack-name <stack-name> \
  --region <stack-region>
```

Deleting a stack will remove all AWS resources created by that stack. However, if you allowed the stack to automatically create a dedicated S3 bucket for failed Lambda invocations, that bucket will not be deleted if it contains objects, because CloudFormation doesn't force-delete non-empty buckets. To remove the bucket entirely, you must empty it manually before deleting it.

If you specified an existing bucket through the `S3FailureBucketARN` parameter instead, that bucket will not be deleted because it is not managed by the stack.

:::{dropdown} Example: Deleting a stack

The following command deletes the `edot-cloud-forwarder-vpc` stack:

```sh
aws cloudformation delete-stack \
  --stack-name edot-cloud-forwarder-vpc \
  --region eu-central-1
```

You can monitor the deletion progress in the AWS Console under **CloudFormation** → **Stacks**, or through this command:

```sh
aws cloudformation describe-stacks \
  --stack-name <stack-name> \
  --region <stack-region>
```

If the stack deletion fails and remains in a `DELETE_FAILED` state, you can retry the deletion with force mode:

```sh
aws cloudformation delete-stack \
  --stack-name edot-cloud-forwarder-vpc \
  --region eu-central-1 \
  --deletion-mode FORCE_DELETE_STACK
```

This forcibly deletes the stack's resources, except any that cannot be deleted, like the failure S3 bucket if it still contains objects. For a complete cleanup, empty the bucket manually before retrying deletion.
:::
